<!DOCTYPE html>
<html>
<head>
    <title>API de Dados</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyClmS9QnPH_HpLzN8mGW2s2PjfH4HXEAt8",
            authDomain: "horariosite-669d1.firebaseapp.com",
            projectId: "horariosite-669d1"
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Variável para armazenar os dados
        let firebaseData = {};
        
        // Função para carregar todos os dados
        async function loadAllData() {
            try {
                const collections = ["usuarios", "horarios", "turmas", "aulas", "professores"];
                const newData = {};
                
                for (const collectionName of collections) {
                    try {
                        const snapshot = await db.collection(collectionName).get();
                        newData[collectionName] = snapshot.docs.map(doc => ({
                            id: doc.id,
                            data: doc.data()
                        }));
                    } catch (error) {
                        console.error(`Erro ao carregar ${collectionName}:`, error);
                    }
                }
                
                firebaseData = newData;
                console.log("Dados atualizados em:", new Date());
            } catch (error) {
                console.error("Erro ao atualizar dados:", error);
            }
        }
        
        // Atualiza os dados a cada 5 segundos
        loadAllData(); // Carrega imediatamente
        setInterval(loadAllData, 5000); // Atualiza a cada 5 segundos
        
        // Função para responder às requisições
        window.getFirebaseData = function() {
            return firebaseData;
        };
    </script>
</head>
<body>
    <!-- Página vazia, funciona apenas como endpoint -->
    <script>
        // Esta parte é necessária para o GitHub Pages
        // Transforma a página em um endpoint que retorna JSON
        const dataToSend = {
            usuarios: window.getFirebaseData().usuarios || [],
            horarios: window.getFirebaseData().horarios || [],
            turmas: window.getFirebaseData().turmas || [],
            aulas: window.getFirebaseData().aulas || [],
            professores: window.getFirebaseData().professores || []
        };
        
        document.write(`
            <script>
                parent.postMessage({
                    type: 'FIREBASE_DATA',
                    data: ${JSON.stringify(dataToSend)}
                }, '*');
            </script>
        `);
    </script>
</body>
</html>
