<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | HORÁRIO</title>
    <style>
        /* [Mantido o mesmo estilo do código anterior] */
    </style>
</head>
<body>
    <!-- [Mantido o mesmo header e estrutura HTML do código anterior] -->

    <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwUd5AKH3KMuv4et_1adRutxOQKhzSjUTdCFowsiWQ_EoOkHdNqeFi44KvdqyMSKwV0kw/exec';
    
    async function findUserByIdentificacao(identificacao) {
        try {
            console.log('Enviando identificacao:', identificacao);
            const response = await fetch(`${SCRIPT_URL}?action=getUser&identificacao=${encodeURIComponent(identificacao)}`);
            
            if (!response.ok) throw new Error('Erro na resposta do servidor');
            
            const result = await response.json();
            console.log('Resposta do servidor:', result);
            return result;
        } catch (error) {
            console.error("Erro na requisição:", error);
            return { success: false, message: error.message };
        }
    }

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const identificacao = document.getElementById('loginInput').value.trim();
        const senha = document.getElementById('senha').value;
        
        try {
            toggleLoader(true);
            
            const result = await findUserByIdentificacao(identificacao);
            
            if (!result.success) {
                throw new Error(result.message || 'Identificação não encontrada');
            }
            
            if (!result.userData) {
                throw new Error('Dados do usuário não retornados');
            }
            
            if (result.userData.senha !== senha) {
                throw new Error('Senha incorreta');
            }
            
            localStorage.setItem('userData', JSON.stringify(result.userData));
            window.location.href = 'https://horario.site/painel.html';
            
        } catch (error) {
            console.error('Erro no login:', error);
            document.getElementById('loginError').textContent = error.message;
            document.getElementById('loginError').style.display = 'block';
        } finally {
            toggleLoader(false);
        }
    });
</script>
</body>
</html>
