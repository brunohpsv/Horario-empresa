<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro | HORÁRIO</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        header {
            background-color: #000000;
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 30px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: #cccccc;
        }
        
        .login-btn {
            background-color: #4CAF50;
            padding: 8px 16px;
            border-radius: 4px;
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            display: flex;
            gap: 30px;
        }
        
        .form-container {
            flex: 2;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .plano-container {
            flex: 1;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        h1 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="file"],
        input[type="number"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .plano-box {
            border: 2px solid #4CAF50;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .plano-preco {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin: 10px 0;
        }
        
        .plano-descricao {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .plano-info {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
        }
        
        .plano-info h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .plano-info p {
            font-size: 14px;
            line-height: 1.5;
            color: #555;
        }
        
        .termos {
            margin: 20px 0;
            font-size: 14px;
        }
        
        .termos a {
            color: #4CAF50;
            text-decoration: none;
        }
        
        .btn-enviar {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        
        .btn-enviar:hover {
            background-color: #45a049;
        }
        
        .mensagem-sucesso {
            display: none;
            background: #dff0d8;
            color: #3c763d;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            text-align: center;
        }
        
        .credenciais-acesso {
            display: none;
            background: #e7f3fe;
            color: #31708f;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid #31708f;
        }
        
        .exemplo {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
            font-style: italic;
        }
        
        .senha-input-container {
            position: relative;
        }

        .senha-input-container input {
            padding-right: 40px;
        }

        .btn-toggle-senha {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 18px;
        }

        .btn-toggle-senha:hover {
            color: #333;
        }
        
        .aviso-demo {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .aviso-demo h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .aviso-termos {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
        }
        
        .aviso-termos h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .contato-suporte {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .contato-suporte h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .contato-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .contato-item i {
            margin-right: 10px;
            color: #2196F3;
        }
        
        .atendentes-container {
            margin-top: 15px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .servico-container {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            background-color: #fff;
        }
        
        .servico-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .servico-title {
            font-weight: bold;
        }
        
        .servico-nomes {
            width: 100%;
        }
        
        .servico-nomes input {
            margin-bottom: 5px;
        }
        
        .add-nome-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-nome-btn:hover {
            background-color: #45a049;
        }
        
        .duplicado-aviso {
            color: #d32f2f;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">HORÁRIO</div>
        <nav>
            <ul>
                <li><a href="https://horario.site">Início</a></li>
                <li><a href="https://horario.site/login.html" class="login-btn">Login</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="form-container">
            <h1>Cadastro de Usuário</h1>
            <form id="formCadastro">
                <div class="form-group">
                    <label for="tipo-pessoa">Tipo de Pessoa</label>
                    <select id="tipo-pessoa" required>
                        <option value="">Selecione...</option>
                        <option value="pf">Pessoa Física (CPF)</option>
                        <option value="pj">Pessoa Jurídica (CNPJ)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="identificacao" id="label-identificacao">CPF/CNPJ</label>
                    <input type="text" id="identificacao" required>
                    <div class="duplicado-aviso" id="identificacao-duplicado">Este CPF/CNPJ já está cadastrado em nosso sistema</div>
                </div>
                
                <div class="form-group">
                    <label for="nome-fantasia" id="label-nome-fantasia">Nome Fantasia (Empresa) ou Nome Completo (Pessoa Física)</label>
                    <input type="text" id="nome-fantasia" required>
                    <div class="duplicado-aviso" id="nome-duplicado">Este nome já está cadastrado em nosso sistema</div>
                </div>
                
                <div class="form-group">
                    <label for="endereco">Endereço</label>
                    <input type="text" id="endereco" placeholder="Rua" required>
                    <div class="duplicado-aviso" id="endereco-duplicado">Este endereço já está cadastrado em nosso sistema</div>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex: 3;">
                            <label for="bairro">Bairro/Setor</label>
                            <input type="text" id="bairro" required>
                            <div class="duplicado-aviso" id="bairro-duplicado">Este bairro já está cadastrado em nosso sistema</div>
                        </div>
                        <div style="flex: 1;">
                            <label for="numero">Número</label>
                            <input type="text" id="numero" required>
                            <div class="duplicado-aviso" id="numero-duplicado">Este número já está cadastrado em nosso sistema</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex: 2;">
                            <label for="cidade">Cidade</label>
                            <input type="text" id="cidade" required>
                            <div class="duplicado-aviso" id="cidade-duplicado">Esta cidade já está cadastrada em nosso sistema</div>
                        </div>
                        <div style="flex: 1;">
                            <label for="estado">Estado</label>
                            <input type="text" id="estado" required>
                            <div class="duplicado-aviso" id="estado-duplicado">Este estado já está cadastrado em nosso sistema</div>
                        </div>
                        <div style="flex: 1;">
                            <label for="cep">CEP</label>
                            <input type="text" id="cep" required>
                            <div class="duplicado-aviso" id="cep-duplicado">Este CEP já está cadastrado em nosso sistema</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="telefone">Telefone/Celular do Responsável</label>
                    <input type="tel" id="telefone" placeholder="(XX) XXXXX-XXXX" required>
                    <div class="duplicado-aviso" id="telefone-duplicado">Este telefone já está cadastrado em nosso sistema</div>
                </div>
                
                <div class="form-group">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" required>
                    <div class="duplicado-aviso" id="email-duplicado">Este e-mail já está cadastrado em nosso sistema</div>
                </div>
                
                <div class="form-group">
                    <label for="maquinas">Quantas máquinas irão usar? (Máximo 30)</label>
                    <input type="number" id="maquinas" min="1" max="30" value="1" required>
                    <div class="exemplo">Para mais de 30 máquinas, entre em contato para negociar o valor</div>
                </div>
                
                <div class="form-group">
                    <label for="atendentes">Quantos serviços diferentes serão oferecidos?</label>
                    <input type="number" id="atendentes" min="0" max="30" value="0">
                    <div id="atendentes-container" class="atendentes-container" style="display: none;"></div>
                </div>
                
                <div class="form-group" id="servicos-group">
                    <label for="servicos">Quais serviços sua empresa presta?</label>
                    <textarea id="servicos" rows="3"></textarea>
                    <div class="exemplo">Exemplo: Clínica médica geral / Odontologia / Dermatologia / Psicologia - Separe os serviços com barras (/)</div>
                </div>
                
                <div class="form-group">
                    <label for="documento">Documento de Identificação</label>
                    <input type="file" id="documento" required>
                    <small>Envie Identidade, CNH ou Cartão CNPJ (PDF ou imagem)</small>
                </div>
                
                <div class="termos">
                    <input type="checkbox" id="concordo" required>
                    <label for="concordo">Concordo com os <a href="termos.html">termos</a> adotados para utilização dessa plataforma, respeitando todos os direitos do site</label>
                </div>
                
                <button type="submit" class="btn-enviar">Enviar Cadastro</button>
                
                <div id="mensagemSucesso" class="mensagem-sucesso">
                    Seu cadastro está em análise, por 24h. Neste período a nossa equipe entrará em contato para efetivar seu cadastro.
                </div>
                
                <div id="credenciaisAcesso" class="credenciais-acesso">
                    <h3>Suas Credenciais de Acesso</h3>
                    <p><strong>Login:</strong> <span id="cred-login"></span></p>
                    <p><strong>Senha:</strong> <span id="cred-senha"></span></p>
                    <p>Guarde essas informações em local seguro. Você poderá alterar a senha após o primeiro login.</p>
                </div>
            </form>
        </div>
        
        <div class="plano-container">
            <div class="plano-box">
                <h3>Plano Único</h3>
                <div class="plano-preco">R$ 30,00/mês</div>
                <div class="plano-descricao">
                    Acesso completo à plataforma com todos os recursos disponíveis para seu negócio.
                </div>
            </div>
            
            <div class="plano-info">
                <h4>Sobre seu Plano</h4>
                <p>O seu plano te dá direito a usar até 30 máquinas com 1 administrador. Isso significa que:</p>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li style="margin-bottom: 8px;">Se seu estabelecimento tem até 30 profissionais que precisam de agendamentos individuais, cada um terá seu perfil próprio</li>
                    <li style="margin-bottom: 8px;">Se sua empresa oferece vários serviços, você poderá criar uma página personalizada onde os clientes escolhem o serviço e o profissional desejado</li>
                    <li>Ideal para clínicas, consultórios, salões e outros negócios com múltiplos prestadores de serviço</li>
                </ul>
            </div>
            
            <div class="aviso-demo">
                <h4>Período de Demonstração</h4>
                <p>Você terá acesso a uma <strong>demonstração gratuita de 7 dias úteis</strong> após a aprovação do cadastro.</p>
                <p>Após este período, sua conta só será liberada após a confirmação do pagamento da assinatura mensal.</p>
            </div>
            
            <div class="aviso-termos">
                <h4>Leia os Termos Atentamente</h4>
                <p>É fundamental que você leia e compreenda todos os termos de uso antes de enviar seu cadastro.</p>
                <p>O envio deste formulário implica na aceitação total dos termos e condições da plataforma.</p>
            </div>
            
            <div class="contato-suporte">
                <h4>Precisa de Ajuda?</h4>
                <p>Entre em contato com nosso suporte:</p>
                <div class="contato-item">
                    <i class="fas fa-envelope"></i>
                    <span>suportehorario@gmail.com</span>
                </div>
                <p style="margin-top: 10px;">Estamos disponíveis para esclarecer dúvidas sobre a plataforma, termos de uso ou qualquer outra informação.</p>
            </div>
        </div>
    </div>

    <!-- Importação do Firebase v9 (modular via CDN) -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { 
            getFirestore, 
            doc,
            setDoc,
            collection,
            query,
            where,
            getDocs
        } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
        import {
            getAuth,
            createUserWithEmailAndPassword
        } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAfk7tS6Z39uYyHnbKlwY1O1zeOx74LlQg",
            authDomain: "banco-de-dados-d253e.firebaseapp.com",
            projectId: "banco-de-dados-d253e",
            storageBucket: "banco-de-dados-d253e.appspot.com",
            messagingSenderId: "1005413315224",
            appId: "1:1005413315224:web:c87d1dd951785ed4f656ed"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Função para gerar senha aleatória
        function gerarSenha() {
            const caracteres = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let senha = '';
            for (let i = 0; i < 8; i++) {
                senha += caracteres.charAt(Math.floor(Math.random() * caracteres.length));
            }
            return senha;
        }

        // Função para gerar código de login numérico
        function gerarCodigoLogin(nomeEmpresa) {
            const codigo = Math.floor(10000000 + Math.random() * 90000000);
            return `${nomeEmpresa.split(' ')[0]} - ${codigo}`;
        }

        // Alternar entre CPF e CNPJ
        document.getElementById('tipo-pessoa').addEventListener('change', function() {
            const label = document.getElementById('label-identificacao');
            const nomeLabel = document.getElementById('label-nome-fantasia');
            
            if (this.value === 'pj') {
                label.textContent = 'CNPJ';
                nomeLabel.textContent = 'Nome Fantasia da Empresa';
            } else {
                label.textContent = 'CPF';
                nomeLabel.textContent = 'Nome Completo (Titular do CPF)';
            }
        });

        // Função para gerar horários baseados na configuração
        function gerarHorariosPadrao(config) {
            const horarios = [];
            let horaAtual = new Date();
            horaAtual.setHours(parseInt(config.horarioAbertura.split(':')[0]), 0, 0, 0);

            const horaFim = new Date();
            horaFim.setHours(parseInt(config.horarioFechamento.split(':')[0]), 0, 0, 0);

            while (horaAtual < horaFim) {
                horarios.push(horaAtual.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }));
                horaAtual.setMinutes(horaAtual.getMinutes() + config.intervaloAtendimento);
            }

            return horarios;
        }

        // Gerar campos de atendentes dinamicamente
        document.getElementById('atendentes').addEventListener('change', function() {
            const qtdServicos = parseInt(this.value);
            const container = document.getElementById('atendentes-container');
            
            container.innerHTML = '';
            
            if (qtdServicos > 0) {
                container.style.display = 'block';
                
                for (let i = 0; i < qtdServicos; i++) {
                    const servicoDiv = document.createElement('div');
                    servicoDiv.className = 'servico-container';
                    
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'servico-header';
                    
                    const titleSpan = document.createElement('span');
                    titleSpan.className = 'servico-title';
                    titleSpan.textContent = `Serviço ${i+1}`;
                    
                    const addBtn = document.createElement('button');
                    addBtn.className = 'add-nome-btn';
                    addBtn.innerHTML = '<i class="fas fa-plus"></i> Adicionar Nome';
                    addBtn.onclick = function() { adicionarCampoNome(i); };
                    
                    headerDiv.appendChild(titleSpan);
                    headerDiv.appendChild(addBtn);
                    
                    const servicoLabel = document.createElement('label');
                    servicoLabel.textContent = 'Nome do Serviço';
                    
                    const servicoInput = document.createElement('input');
                    servicoInput.type = 'text';
                    servicoInput.id = `servico-${i}`;
                    servicoInput.required = true;
                    servicoInput.placeholder = 'Ex: Oftalmologista';
                    
                    const nomesDiv = document.createElement('div');
                    nomesDiv.className = 'servico-nomes';
                    nomesDiv.id = `nomes-container-${i}`;
                    
                    // Adiciona um campo de nome inicial para cada serviço
                    const nomeInput = document.createElement('input');
                    nomeInput.type = 'text';
                    nomeInput.id = `nome-${i}-0`;
                    nomeInput.required = true;
                    nomeInput.placeholder = 'Nome do profissional';
                    
                    nomesDiv.appendChild(nomeInput);
                    
                    servicoDiv.appendChild(headerDiv);
                    servicoDiv.appendChild(servicoLabel);
                    servicoDiv.appendChild(servicoInput);
                    servicoDiv.appendChild(nomesDiv);
                    container.appendChild(servicoDiv);
                }
                
                // Tornar campo de serviços não obrigatório
                document.getElementById('servicos').required = false;
                document.getElementById('servicos-group').style.opacity = '0.7';
            } else {
                container.style.display = 'none';
                document.getElementById('servicos').required = true;
                document.getElementById('servicos-group').style.opacity = '1';
            }
        });

        // Função para adicionar campo de nome para um serviço
        function adicionarCampoNome(servicoIndex) {
            const nomesContainer = document.getElementById(`nomes-container-${servicoIndex}`);
            const nomeCount = nomesContainer.querySelectorAll('input').length;
            
            const nomeInput = document.createElement('input');
            nomeInput.type = 'text';
            nomeInput.id = `nome-${servicoIndex}-${nomeCount}`;
            nomeInput.placeholder = 'Nome do profissional';
            
            nomesContainer.appendChild(nomeInput);
        }

        // Verificar campos duplicados no Firestore
        async function verificarCamposDuplicados() {
            const campos = [
                { id: 'identificacao', field: 'identificacao', msgId: 'identificacao-duplicado' },
                { id: 'nome-fantasia', field: 'nomeFantasia', msgId: 'nome-duplicado' },
                { id: 'endereco', field: 'endereco', msgId: 'endereco-duplicado' },
                { id: 'bairro', field: 'bairro', msgId: 'bairro-duplicado' },
                { id: 'numero', field: 'numero', msgId: 'numero-duplicado' },
                { id: 'cidade', field: 'cidade', msgId: 'cidade-duplicado' },
                { id: 'estado', field: 'estado', msgId: 'estado-duplicado' },
                { id: 'cep', field: 'cep', msgId: 'cep-duplicado' },
                { id: 'telefone', field: 'telefone', msgId: 'telefone-duplicado' },
                { id: 'email', field: 'email', msgId: 'email-duplicado' }
            ];
            
            let temDuplicado = false;
            
            for (const campo of campos) {
                const valor = document.getElementById(campo.id).value.trim();
                if (valor) {
                    const q = query(collection(db, "usuarios"), where(campo.field, "==", valor));
                    const querySnapshot = await getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        document.getElementById(campo.msgId).style.display = 'block';
                        temDuplicado = true;
                    } else {
                        document.getElementById(campo.msgId).style.display = 'none';
                    }
                }
            }
            
            return temDuplicado;
        }

        // Função para formatar os serviços e nomes dos atendentes como array de objetos
        function formatarServicosAtendentes(qtdServicos) {
            const servicosAtendentes = [];
            
            for (let i = 0; i < qtdServicos; i++) {
                const servico = document.getElementById(`servico-${i}`).value.trim();
                const nomesInputs = document.querySelectorAll(`#nomes-container-${i} input`);
                
                const nomes = Array.from(nomesInputs)
                    .map(input => input.value.trim())
                    .filter(nome => nome);
                
                if (servico && nomes.length > 0) {
                    servicosAtendentes.push({
                        servico: servico,
                        atendentes: nomes
                    });
                }
            }
            
            return servicosAtendentes;
        }

        // Adicionar verificação de duplicados ao enviar formulário
        document.getElementById('formCadastro').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const btn = e.target.querySelector('button[type="submit"]');
            const btnOriginalText = btn.textContent;
            btn.textContent = 'Verificando...';
            btn.disabled = true;
            
            // Verificar campos duplicados
            const temDuplicado = await verificarCamposDuplicados();
            
            if (temDuplicado) {
                alert('Por favor, corrija os campos marcados em vermelho antes de enviar.');
                btn.textContent = btnOriginalText;
                btn.disabled = false;
                return;
            }
            
            btn.textContent = 'Enviando...';
            
            try {
                // Coletar dados do formulário
                const email = document.getElementById('email').value;
                const nomeFantasia = document.getElementById('nome-fantasia').value;
                const qtdServicos = parseInt(document.getElementById('atendentes').value);
                
                // Gerar senha e login automaticamente
                const senha = gerarSenha();
                const login = gerarCodigoLogin(nomeFantasia);
                
                // Coletar dados dos serviços e atendentes se existirem
                let servicoAtendente = [];
                
                if (qtdServicos > 0) {
                    servicoAtendente = formatarServicosAtendentes(qtdServicos);
                }
                
                // Coletar serviços gerais se não houver atendentes
                const servicos = document.getElementById('servicos').value.trim();
                
                const formData = {
                    tipoPessoa: document.getElementById('tipo-pessoa').value,
                    identificacao: document.getElementById('identificacao').value,
                    nomeFantasia: nomeFantasia,
                    endereco: document.getElementById('endereco').value,
                    bairro: document.getElementById('bairro').value,
                    numero: document.getElementById('numero').value,
                    cidade: document.getElementById('cidade').value,
                    estado: document.getElementById('estado').value,
                    cep: document.getElementById('cep').value,
                    telefone: document.getElementById('telefone').value,
                    email: email,
                    login: login,
                    senha: senha, // Armazenando a senha no Firestore também
                    maquinas: document.getElementById('maquinas').value,
                    servicos: qtdServicos > 0 ? '' : servicos, // Só preenche serviços se não houver atendentes
                    servicoAtendente: servicoAtendente, // Array de objetos com serviços e seus atendentes
                    documento: document.getElementById('documento').files[0]?.name || 'Nenhum arquivo enviado',
                    dataCadastro: new Date().toISOString(),
                    status: 'pendente'
                };

                // Configuração padrão de horários
                const horariosConfig = {
                    diasFuncionamento: ["1", "2", "3", "4", "5"], // Segunda a Sexta
                    horarioAbertura: "08:00",
                    horarioFechamento: "18:00",
                    duracaoAtendimento: 30,
                    intervaloAtendimento: 15
                };

                // 1. Criar usuário no Authentication (usando email e senha gerada)
                const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
                const userId = userCredential.user.uid;
                
                // 2. Salvar dados no Firestore com a configuração de horários
                await setDoc(doc(db, "usuarios", userId), {
                    ...formData,
                    horariosConfig: horariosConfig
                });

                // 3. Criar um documento de exemplo na subcoleção "horarios" (para a data atual)
                const dataAtual = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                await setDoc(doc(db, "usuarios", userId, "horarios", dataAtual), {
                    horariosDisponiveis: gerarHorariosPadrao(horariosConfig),
                    horariosAgendados: []
                });
                
                // 4. Mostrar mensagem de sucesso
                document.getElementById('mensagemSucesso').style.display = 'block';
                document.getElementById('credenciaisAcesso').style.display = 'block';
                document.getElementById('cred-login').textContent = login;
                document.getElementById('cred-senha').textContent = senha;
                
                // 5. Limpar formulário
                document.getElementById('formCadastro').reset();
                document.getElementById('atendentes-container').style.display = 'none';
                document.getElementById('servicos-group').style.opacity = '1';
                window.scrollTo(0, document.body.scrollHeight);
                
            } catch (error) {
                console.error("Erro ao enviar cadastro:", error);
                alert("Ocorreu um erro ao enviar seu cadastro: " + error.message);
            } finally {
                btn.textContent = btnOriginalText;
                btn.disabled = false;
            }
        });

        // Máscaras para os campos
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 2) {
                value = `(${value.substring(0,2)}) ${value.substring(2)}`;
            }
            if (value.length > 10) {
                value = `${value.substring(0,10)}-${value.substring(10,14)}`;
            }
            e.target.value = value;
        });

        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 5) {
                value = `${value.substring(0,5)}-${value.substring(5,8)}`;
            }
            e.target.value = value;
        });

        // Verificar duplicados ao sair dos campos
        const camposParaVerificar = [
            'identificacao', 'nome-fantasia', 'endereco', 'bairro', 'numero',
            'cidade', 'estado', 'cep', 'telefone', 'email'
        ];
        
        camposParaVerificar.forEach(id => {
            document.getElementById(id).addEventListener('blur', async function() {
                await verificarCamposDuplicados();
            });
        });
    </script>
</body>
</html>
